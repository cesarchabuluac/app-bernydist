var DOMINIOdisenojs="berny.mx",DIREC_ENVIO_DIRCLIID;let _isMinimun2=!1;function SendDir(e){var a=document.getElementById("es_publico").value;$(".observation_locations").empty(),$("#dir_consig_id").val(e),$(".adresssz").each(function(){$("#"+$(this).attr("id")).css({background:""})}),DIREC_ENVIO_DIRCLIID=e,1==a&&(loading("confirmShipping"),loading("confirmTotal"),getShippingCost(DIREC_ENVIO_DIRCLIID).then(e=>{e.grandTotalNoFormat;var a=$("#positive_balance").val();$(".confirmShipping").html("$ "+e.shipping),$(".confirmTotal").html("$ "+e.grandTotal),$(".cardSubtotal").html("$"+e.total),$(".shipping_cost").html("$"+e.shipping),$(".grantotal").html("$"+e.grandTotal),$("#MontoTotales").val(e.grandTotalNoFormat),$(".observation_locations").html(e.message);a=e.grandTotalNoFormat-a;$(".confirmGrandTotal").html("$ "+formatCurency(a))}).catch(e=>console.log(e))),0<(DIREC_ENVIO_DIRCLIID=$.trim(DIREC_ENVIO_DIRCLIID)).length&&(1==a?1==$("input[name=isInvoice]:checked").val()?($("#btn_confirmCRT2").addClass("hidden"),$("#btn_process_invoice").removeClass("hidden")):($("#btn_confirmCRT2").removeClass("hidden"),$("#btn_process_invoice").addClass("hidden")):document.getElementById("btn_confirmCRT2").disabled=!1,$("#"+DIREC_ENVIO_DIRCLIID).css({background:"#9F9"}))}function XY2034(){document.getElementById("acept1").innerHTML='<img alt="accept" src="assets/img/accept.png">',document.getElementById("btn_confirmCRT2").disabled=!1,$("#lostadress").html(""),DIREC_ENVIO_DIRCLIID=""}function ActivaConfirmarPrecio2(){1==document.getElementById("RecogerAlmacenAux1").checked&&($("#lostadress").html('Procesando...<img alt="loading" src="assets/img/loading.gif">'),storePickup("S").then(e=>{e=e.CLT_RECOJE.toUpperCase();if("S"!=$.trim(e))return!1;setTimeout(function(){XY2034()},100)}).catch(e=>(console.log(e),!1))),1==document.getElementById("RecogerAlmacenAux2").checked&&($("#lostadress").html('Procesando... alt="loading" src="assets/img/loading.gif">'),storePickup("N").then(e=>{e=e.CLT_RECOJE.toUpperCase();if("N"!=$.trim(e))return!1;XY2044()}).catch(e=>(console.log(e),!1)))}function XY2044(){document.getElementById("btn_confirmCRT2").disabled=!0,document.getElementById("acept1").innerHTML="";let t=" ";loadAddressLost({opcion:" ",fiscal:0}).then(e=>{$("#lostadress").empty(),e.status&&($.each(e.data,function(e,a){t+=` 
                    <div class="adresssz" onclick='SendDir(this.id)' data-ppal='${a.es_dir_ppal}' id='${a.dir_cli_id}' observation='${a.observaciones}' style="background:#F4F4F4; border-bottom:#666 solid 1px;font-size:12px;font-weight:normal;cursor:pointer;">
                    <br>${a.calle} ${a.estado} ${a.ciudad} ${a.localidad} ${a.codigo_postal}</div>`}),$("#lostadress").html(t),$("#adresss").change(function(){document.getElementById("btn_confirmCRT2").disabled=!1}))}).catch(e=>console.log(e))}function saveCotizacion(){var e=document.getElementById("MontoTotales").value;let t=$("#monto_a_dividir").val();$("#dividirFacturacion").is(":checked")||(t=0),$(".is_invoice").addClass("hidden");var o=DIREC_ENVIO_DIRCLIID;if(0<parseFloat(e)){document.getElementById("ContmodalAlerta").innerHTML='Procesando...<img alt="loading" src="assets/img/loading.gif">',MostrarAlerta(),document.getElementById("savicotizacion0").innerHTML='<img alt="loading" src="assets/img/loading.gif">';let a=$("#pedido_web_id").val();o={opcion:" ",data:a,dm:t,dir_consig_id:o};saveQuote(o).then(e=>{a=e.id,$("#creada").html(a),$("#creada2").val(a),$("#idpedido3").val(a),$("#idpedido4").val(a),$("#id_id").val(a),$("#idpedido3").val($("#creada").html()),$("#ControlImpresion").html('<input type="button" value=""  class="btn icobtn-successImprimir" onClick="javascript:document.getElementById(\'000003\').submit()"/>'),document.getElementById("savicotizacion0").innerHTML='<input type="button" value="Guardar" id="savicotizacion"  class="btn btn-success btn btn-default"  onClick="saveCotizacion()"/>',$("#modalAlerta").modal("hide")}).catch(e=>console.log(e))}else alert("No hay Productos.");return!0}function nuevaCotizar(){var e={opcion:" ",data:$("#pedido_web_id").val()};saveQuote(e,!0).then(e=>{console.log(e),"completed"===e.status&&document.getElementById("form_pedidos2").submit()}).catch(e=>console.log(e))}function ValidandoDivisionMonto(){var e,t,o=!0;return document.getElementById("dividirFacturacion").checked&&(e=(e=$("#monto_a_dividir").val()).replace("$",""),e=(e=$.trim(e)).replace(",",""),e=(e=$.trim(e)).replace(" ",""),e=$.trim(e),t=parseFloat(e),$(".product_priceP").each(function(){var e=(e=$.trim($(this).html())).replace("$","");e=(e=$.trim(e)).replace(",",""),e=(e=$.trim(e)).replace(" ",""),e=$.trim(e);var a=parseFloat(e);a==t||a<t||(alert("Excedio un Artículo la división de monto : $"+e),o=!1)})),o}function pedirCotizacion(){let a=document.getElementById("es_publico").value,e=document.getElementById("dir_cli_id_principal").value;document.getElementById("dir_consig_id").value;var t=document.getElementById("existsAddressShipping");let o=document.getElementById("isPickup");if(null==t||0!=t.dataset.value){let d="";if(e.includes("-"))Swal.fire({allowOutsideClick:!1,closeOnClickOutside:!1,allowEscapeKey:!1,title:"Datos incompletos!",text:"¡Estimado usuario es necesario completar la información de su cuenta para poder realizar un pedido!",icon:"warning",confirmButtonColor:"#5cb85c",confirmButtonText:"Aceptar"}).then(()=>{window.location.href="spages/mis_datos"});else{if(!ValidandoDivisionMonto())return!1;t=document.getElementById("MontoTotales").value;if(parseFloat(t)<1)return!1;document.getElementById("creada")&&(t={opcion:" ",data:$("#pedido_web_id").val()},saveQuote(t).then(e=>{$("#creada").html(e.id),$("#creada2").val(e.id),$("#idpedido3").val(e.id),$("#idpedido4").val(e.id),$("#id_id").val(e.id),$("#idpedido3").val($("#creada").html()),$("#ControlImpresion").html('<input type="button" value=""  class="btn icobtn-successImprimir" onClick="javascript:document.getElementById(\'000003\').submit()"/>'),document.getElementById("savicotizacion0").innerHTML='<input type="button" value="Guardar" id="savicotizacion"  class="btn btn-success btn btn-default"  onClick="saveCotizacion()"/>'}).catch(e=>console.log(e)));1==a||1==a?($("#lostadress").html('Procesando...<img alt="loading" src="assets/img/loading.gif">'),loadAddressLost({opcion:" ",fiscal:0}).then(e=>{$("#lostadress").empty(),$(".is_invoice").removeClass("hidden"),$(".observation_locations").empty();let o=null,i=!1,n=null;if(e.status){let t=1;$.each(e.data,function(e,a){"S"===a.es_dir_ppal&&(i=!0,n=a.dir_cli_id,o=a.observaciones),d+=`
						<div class="adresssz" onclick='SendDir(this.id)' data-ppal='${a.es_dir_ppal}' id='${a.dir_cli_id}' style="background:#F4F4F4;text-align: left; border-bottom:#666 solid 1px;font-size:12px;font-weight:normal;cursor:pointer;">
						<br>${t}.- ${a.calle} ${a.estado} ${a.ciudad} ${a.localidad} ${a.codigo_postal}</div>`,t++}),document.getElementById("ContmodalAlerta").style.textAlign="left",document.getElementById("ContmodalAlerta").innerHTML=`*Seleccione la direccion de entrega <button type="button" onclick="openModalAddAddress()" id="link-add-address" name="link-add-address" class='btn-link pull-right'> <i class='fa fa-plus'></i> Agregar</button><br><br> `+d,i&&($("#"+n).css({background:"#9F9"}),$(".observation_locations").html(o),document.getElementById("btn_confirmCRT2").disabled=!0)}else $(".is_invoice").addClass("hidden"),d+=`<div class="alert" style="padding: 15px 15px; background: rgb(220, 53, 69); z-index: 999999; font-size: 16px; font-weight: 300; color: rgba(255, 255, 255, 0.9)">
            <h4><i class="icon fa fa-ban"></i> Direcciones en proceso...</h4>
           Actualmente no cuenta con direcciones válidas para el envio de su pedido!.
          </div>`,document.getElementById("ContmodalAlerta").innerHTML=d+" <br><br><br>",isValidAddress=!1}).catch(e=>console.log(e))):d="<br>"+`
        <span style="font-weight:bold; font-size:14px;">
        <img alt="envios60x39" src="assets/img/envios60x39.png">
          <table>
              <tr>
                <td>
                  <input type="radio" name="RecogerAlmacenAux1" id="RecogerAlmacenAux1" onChange="ActivaConfirmarPrecio2()"  value="S">
                  Recoger en Tienda 
                </td>
                <td>
                    <div id="acept1"></div>
                </td>
            </tr>
            <tr>
                  <td colspan="2"><br></td>
            </tr>
            <tr>
                <td>
                    <input type="radio" name="RecogerAlmacenAux1" id="RecogerAlmacenAux2" onChange="ActivaConfirmarPrecio2()"  value="N">
                    Enviar a Domicilio
                </td>
                <td></td>
            </tr>
        </table>
        <hr>
        <div id="lostadress" style="width:100%; height:100px; overflow:auto;"></div>
        <!-- <div id="acept2"></div> -->
        </span>				  
  `,document.getElementById("ContmodalAlerta").innerHTML=`<br> *Tu pedido tiene la opción de <br><br>${d} <br><br>`,validteMinimunOrder().then(e=>{if(!e.status)return Swal.fire({allowOutsideClick:!1,closeOnClickOutside:!1,allowEscapeKey:!1,title:"Validación de pedido",text:e.message,icon:"warning",confirmButtonColor:"#5cb85c",confirmButtonText:"Aceptar"}).then(()=>!1),!1;if(1==a||1==a)Swal.fire({allowOutsideClick:!1,closeOnClickOutside:!1,allowEscapeKey:!1,title:"¿Desea factura?",icon:"question",showCancelButton:!0,confirmButtonColor:"#5cb85c",confirmButtonText:"Si",cancelButtonText:"No"}).then(e=>{$(".is_invoice").addClass("hidden"),e.isConfirmed?($(".observation_locations").addClass("hidden"),$("#btn_process_address").removeClass("hidden"),$("#ContmodalAlerta").addClass("hidden"),$("#btn_process_invoice").removeClass("hidden"),$("#btn_process_invoice").click(),$("#body-process_invoice").removeClass("hidden"),$("#btn_confirmCRT2").addClass("hidden"),$("#btn_process_address").prop("disabled",!0)):($("#btn_process_address").addClass("hidden"),$("#btn_confirmCRT2").prop("disabled",!1)),MostrarAlerta()});else{if(null!=o&&1==o.value)return Pre_pedirCotizacion(),!1;MostrarAlerta(),ActivaConfirmarPrecio2()}}).catch(e=>(console.log(e),!1)),document.getElementById("btn_confirmCRT2").disabled=!0}}else Swal.fire({allowOutsideClick:!1,closeOnClickOutside:!1,allowEscapeKey:!1,title:"Validación de dirección",text:"Actualmente no cuenta con direcciones válidas para el envío de su pedido!",icon:"warning",confirmButtonColor:"#5cb85c",confirmButtonText:"Aceptar"})}function pedirCotizacionFlete(){document.getElementById("ContmodalAlerta").innerHTML='<br> *Tu pedido tiene la opción de <br><br><br><span style="font-weight:bold; font-size:14px;"><table><tr><td><input type="radio" name="RecogerAlmacenAux1" id="RecogerAlmacenAux1" onChange="ActivaConfirmarPrecio2()"  value="S">Recoger en Tienda </td><td><div id="acept1"></div></td></tr></table><br><table><tr><td><tr><td><input type="radio" name="RecogerAlmacenAux1" id="RecogerAlmacenAux2" onChange="ActivaConfirmarPrecio2()"  value="N">Enviar a Domicilio <hr><div id="lostadress" style="width:100%;   height:100px; overflow:auto;"></div><img alt="envios60x39" src="assets/img/envios60x39.png"></td><td><div id="acept2"></div></span></td></tr></table> <br><br><br><button type="button" class="btn btn-success" id="btn_confirmCRT2" name="btn_confirmCRT2"  onClick="Pre_pedirCotizacion()"  disabled >Continuar <i class="fa fa-caret-right">',console.log("ALERTA -1 DE PEDIRCOTIZACIONFLETE"),MostrarAlerta(),ActivaConfirmarPrecio2()}function OcultarEdoCta(e){"berny"==e.id?($("#br-docs").removeClass("showoff"),$("#fe-docs").addClass("showoff"),$("#berny").addClass("select-tab"),$("#ferretera").removeClass("select-tab")):"ferretera"==e.id&&($("#fe-docs").removeClass("showoff"),$("#br-docs").addClass("showoff"),$("#ferretera").addClass("select-tab"),$("#berny").removeClass("select-tab"))}function OcultarSecciondePago(e,a){$("#cuentas_bancarias").removeClass("showoff"),"tcred"==e.id?($("#tcred").addClass("active badge badge-info"),$("#cban").removeClass("active badge badge-info"),$("#pefec").removeClass("active badge badge-info"),$("#transf").removeClass("active badge badge-info"),$("#cuentas_bancarias").addClass("showoff"),$("#tarjeta_credito").removeClass("showoff"),$("#pago_efectivo").addClass("showoff"),$("#transferencia").addClass("showoff"),!0===a&&$("#cuentas_bancarias").addClass("showoff")):"cban"==e.id?($("#tcred").removeClass("active badge badge-info"),$("#cban").addClass("active badge badge-info"),$("#pefec").removeClass("active badge badge-info"),$("#transf").removeClass("active badge badge-info"),$("#cuentas_bancarias").removeClass("showoff"),$("#tarjeta_credito").addClass("showoff"),$("#pago_efectivo").addClass("showoff"),$("#transferencia").addClass("showoff")):"pefec"==e.id?($("#tcred").removeClass("active badge badge-info"),$("#cban").removeClass("active badge badge-info"),$("#pefec").addClass("active badge badge-info"),$("#transf").removeClass("active badge badge-info"),$("#cuentas_bancarias").addClass("showoff"),$("#tarjeta_credito").addClass("showoff"),$("#pago_efectivo").removeClass("showoff"),$("#transferencia").addClass("showoff"),!0===a&&$("#cuentas_bancarias").addClass("showoff")):"transf"==e.id&&($("#tcred").removeClass("active badge badge-info"),$("#cban").removeClass("active badge badge-info"),$("#pefec").removeClass("active badge badge-info"),$("#transf").addClass("active badge badge-info"),$("#cuentas_bancarias").addClass("showoff"),$("#tarjeta_credito").addClass("showoff"),$("#pago_efectivo").addClass("showoff"),$("#transferencia").removeClass("showoff"),!0===a&&$("#cuentas_bancarias").addClass("showoff"))}function regresarestatusaedicion(){console.log("Ocurrio un display Text")}function actualizainfopago(e,a){console.log("Entro a actualizar info de pago values:"+e),$.post("spages/actualizainfopago/",{idpedido:e,idconekta:a.id,lcard:a.card,oxxorefer:a.reference,brand:a.brand,name:a.name,email:a.email,amount:a.amount,empresa:a.empresa,barcode_url:a.barcode_url},function(e){console.log("El data trajo:"+e),"1"==e&&($("#metodos_pagos").addClass("showoff"),"oxxo"!=a.card&&"spei"!=a.card?($("#card-form").addClass("showoff"),$("#tks").removeClass("showoff"),$("#pagorefer").text("Número de transación: "+a.id)):"oxxo"===a.card?($("#oxxo-refer").text(a.reference),$("#opps-barcode").attr("src",a.barcode_url),$("#opps-oxxo").removeClass("showoff"),$("#pagaroxxo").addClass("showoff"),$("#oxxo-card-form").addClass("showoff"),$("#tks-oxxo").removeClass("showoff"),$("#pagorefer-oxxo").text("Número de transación: "+a.id)):($("#spei-refer").text(a.reference),$("#opps-spei").removeClass("showoff"),$("#pagarspei").addClass("showoff"),$("#spei-card-form").addClass("showoff"),$("#tks-spei").removeClass("showoff"),$("#pagorefer-spei").text("Número de transación: "+a.id)),$("#bell").removeClass("fa fa-bell-o"),$("#bell").addClass("fa fa-check-square"),$("#bell").attr("style","color:green;"))})}function actualizastatuspedidocltecredito(e,a,i){$.post("spages/actualizastatuspedidocltecredito",{pwi:a,status:i},function(e){var a,t,o=JSON.parse(e);1===o.status&&1===i?(a=o.detail,t=o.header,e=o.shipping,"berny.mx"===document.location.hostname&&(gtag("event","purchase",{transaction_id:t.pedidos_web_id,affiliation:"Google online store",value:t.TOTAL,currency:"MXN",tax:16,shipping:e,items:a}),console.log("gtag purchase: "+t.pedidos_web_id)),verificapendientesdepago(2)):0==i?document.location.href="spages/panel":alert(o.message)})}function guardainformacionarticulo(a,e,t){$.post("spages/guardainformacionarticulo",{info_articulo_id:a,articulo_id:e,informacion:t},function(e){e=JSON.parse(e);console.log("El estatus: "+e.status),e.status?(-1==a&&(console.log("Entro a la seccion de actualizacion de ides"),$("#s-"+a).attr("data-save",e.data),$("#s-"+a).attr("id","s-"+e.data),$("#e-"+a).attr("data-edit",e.data),$("#e-"+a).attr("id","e-"+e.data),$("#"+a).attr("id",e.data),$("#i-"+a).attr("id","i-"+e.data),$("#c-"+a).attr("data-canc",e.data),$("#c-"+a).attr("id","c-"+e.data)),a=e.data,console.log("realizamos las desabilitaciones con el info_articulo_id ahora con valor de: "+a),$("#"+a).attr("disabled",!0),$("#i-"+a).attr("hidden",!0),$("#s-"+a).attr("hidden",!0),$("#c-"+a).attr("hidden",!0),$("#e-"+a).attr("hidden",!1)):alert("No fue posible actualizar la informacion. "+e.message+" Data: "+e.data)})}function guardarOfbArticulo(e,a){$.post("spages/guardarOfbArticulo",{articulo_id:e,ofb:a},function(e){e=JSON.parse(e);console.log("El estatus: "+e.status),e.status?(console.log("El Mensaje: "+e.message),console.log("realizamos las desabilitaciones del OFB "),$("#ofb").attr("disabled",!0),$("#s-ofb").attr("hidden",!0),$("#c-ofb").attr("hidden",!0),$("#e-ofb").attr("hidden",!1),$("#i-ofb").attr("hidden",!0)):alert("No fue posible actualizar el campo otras formas de búsqueda. "+e.message+" Data: "+e.data)})}function openModalAddAddress(){$("#isUpdate").val(0),$("#advertencia").hide(),$(".fiscal-data").hide(),$(".address-modal-title").html("Nueva Dirección"),$("#new_name").val("DIRECCION DE ENTREGA"),$(".new_name").hide(),$("#isFiscal").val("E"),$("#new_tipo_persona").removeAttr("required"),$("#new_rfc").removeAttr("required"),$("#modal-title").html("Direcciones de entrega"),getState().then(e=>{$("#isFiscal").val("E");let a=[];_.map(e,function(e){a.push({id:e.estado_id,text:e.nombre})}),$("#new_state_id").select2({data:a}),$("#modal-address").modal()}).catch(e=>{Swal.fire({title:"Error generado!",html:e.responseText,icon:"error"})}),$("#modal-address").modal()}function nextId(e){let a=0;e=_.filter(e,function(e){for(var a in e.value)if(0==e.value[a].indexOf("-"))return!0;return!1});return a=_.isEmpty(e)?1:(a=_.maxBy(e,"value"),parseInt(a.value.replace("-",""))+1),"-"+a}function ValidaRFC(e){var a=("new_rfc"===e.id?document.getElementById("new_tipo_persona"):document.getElementById("tipo_persona")).value;let t="new_rfc"===e.id?document.getElementById("btn-save"):document.getElementById("btn-update");e.value=e.value.toUpperCase();let o="new_rfc"==e.id?document.getElementById("new_resultado"):document.getElementById("resultado"),i="new_rfc"==e.id?document.getElementById("new_message"):document.getElementById("message"),n;"F"===a&&e.value.match("^(([A-ZÑ&]{4})([0-9]{2})([0][13578]|[1][02])(([0][1-9]|[12][\\d])|[3][01])([A-Z0-9]{3}))|(([A-ZÑ&]{4})([0-9]{2})([0][13456789]|[1][012])(([0][1-9]|[12][\\d])|[3][0])([A-Z0-9]{3}))|(([A-ZÑ&]{4})([02468][048]|[13579][26])[0][2]([0][1-9]|[12][\\d])([A-Z0-9]{3}))|(([A-ZÑ&]{4})([0-9]{2})[0][2]([0][1-9]|[1][0-9]|[2][0-8])([A-Z0-9]{3}))$")?rfcValido(e.value)?(t.disabled=!1,n="Válido",o.classList.remove("has-error"),o.classList.add("has-success"),e.value=e.value.toUpperCase()):(t.disabled=!0,n="No válido",o.classList.remove("has-success"),o.classList.add("has-error")):"M"===a&&e.value.match("^(([A-ZÑ&]{3})([0-9]{2})([0][13578]|[1][02])(([0][1-9]|[12][\\d])|[3][01])([A-Z0-9]{3}))|(([A-ZÑ&]{3})([0-9]{2})([0][13456789]|[1][012])(([0][1-9]|[12][\\d])|[3][0])([A-Z0-9]{3}))|(([A-ZÑ&]{3})([02468][048]|[13579][26])[0][2]([0][1-9]|[12][\\d])([A-Z0-9]{3}))|(([A-ZÑ&]{3})([0-9]{2})[0][2]([0][1-9]|[1][0-9]|[2][0-8])([A-Z0-9]{3}))$")&&rfcValido(e.value)?(n="Válido",t.disabled=!1,o.classList.remove("has-error"),o.classList.add("has-success"),e.value=e.value.toUpperCase()):(t.disabled=!0,n="No válido",o.classList.remove("has-success"),o.classList.add("has-error")),i.innerText="Formato: "+n}function rfcValido(e,a=!0){e=e.match(/^([A-ZÑ&]{3,4}) ?(?:- ?)?(\d{2}(?:0[1-9]|1[0-2])(?:0[1-9]|[12]\d|3[01])) ?(?:- ?)?([A-Z\d]{2})([A\d])$/);if(!e)return!1;const t=e.pop(),o=e.slice(1).join(""),i=o.length,n=i+1;for(var d=12==i?0:481,s=0;s<i;s++)d+="0123456789ABCDEFGHIJKLMN&OPQRSTUVWXYZ Ñ".indexOf(o.charAt(s))*(n-s);return 11==(e=11-d%11)?e=0:10==e&&(e="A"),!!(t==e||a&&o+t=="XAXX010101000")&&(!(!a&&o+t=="XEXX010101000")&&o+t)}function verificapendientesdepago(o=1){let i=baseUrl||null!=baseUrl?baseUrl:"";return $.post(i+"spages/verificapendientesdepago",function(e){if("0"!=e){var a=e.split("|"),t="";return 0<a.length&&(console.log("NVO LO QUE TRAE DATA DENTRO DE verificapendientesdepago: "+JSON.stringify(e)),t=1==o?i+"spages/pago_online?id="+a[1]+"&total="+a[2]+"&name="+a[3]+"&empresa="+a[4]+"&ndp="+a[5]:i+"spages/panel?total="+a[2]+"&empresa="+a[4]+"&ndp="+a[5]+"&totped="+a[6]+"&pid="+a[1],console.log(t)),document.location.href=t,!0}document.location.href=1==o?i+"spages/pago_online?id=0&total=0":i+"spages/panel?total=0&empresa=1&ndp=0&totped=0&pid=0"}),!1}function Pre_pedirCotizacion(){if(_isMinimun2=!1,null!=_isMinimun2&&!0===_isMinimun2)return _isMinimun2=!1,void $("#modalAlerta").modal("toggle");var e,a;1==ValidandoDivisionMonto()&&($(".observation_locations").addClass("hidden"),document.getElementById("btn_confirmCRT2").disabled=!0,document.getElementById("ContmodalAlerta").innerHTML='Procesando...<img alt="loading" src="assets/img/loading.gif">',MostrarAlerta(0),a=0==(e=$("#idpedido3").val()).length?1:0,pedirCotizacion2("PedirCotizacionNull",1==(a=!parseInt(e)?1:a)?"0":e))}function pedirCotizacion2(e,a){var t=document.getElementById("es_publico").value;$("#dir_cli_id_principal").val();let o=null;var i=document.getElementById("MontoTotales").value,n=$("#monto_a_dividir").val(),d=($("#dividirFacturacion"),"");0==document.getElementById("dividirFacturacion").checked&&(n=0);var s,r=DIREC_ENVIO_DIRCLIID,a=a;0<parseFloat(i)?(s='<button type="button" name="btn_confirm2" id="btn_confirmCRT" value="btn_confirm" onClick="pedirCotizacion()" class="btn btn-success">Enviar pedido.<i class="fa fa-caret-right"></i></button>',$("#btn_confirmCRT0").html('<img alt="loading src="assets/img/loading.gif">'),$("#btn_confirmCRT").attr("disabled",!0),$("#savicotizacion").attr("disabled",!0),document.getElementById("idpedido3").value.length,1==t&&((null==r||r<=0)&&(r=document.getElementById("dir_cli_id_principal").value),$("#body-process_invoice").addClass("hidden"),$(".is_invoice").addClass("hidden"),$("#ContmodalAlerta").removeClass("hidden"),o=document.getElementById("uso_cfdi").value,o=0==o?null:o,getShippingCost(r,!0).then(e=>{}).catch(e=>console.log(e))),$.post("spages/"+e+"/",{opcion:"",data:a,dm:n,dir_consig_id:r,rfc:null,cfdi:o},function(e){var a=(e=JSON.parse(e)).id,t=e.edicion,o=e.reason,e=e.svc;return"read"==t&&(console.log("pedirCotizacion2 - d svc: "+e),d="Pedido almacenado","S"==e&&verificapendientesdepago(),$("#btn_confirmCRT2").addClass("hidden")),"minimo"==t?(_isMinimun2=!0,document.getElementById("savicotizacion").disabled=!1,d=o,document.getElementById("btn_update0").disabled=!1,$("#btn_confirmCRT").attr("disabled",!1),$("#savicotizacion").attr("disabled",!1),$("#idpedido3").val(a),$("#idpedido4").val(a),$("#idpedido").val(a),$("#ControlImpresion").html('<input type="button" value=""  class="btn icobtn-successImprimir" onClick="javascript:document.getElementById(\'000003\').submit()"/>'),document.getElementById("savicotizacion0").innerHTML='<input type="button" value="Guardar" id="savicotizacion"  class="btn btn-success btn btn-default"  onClick="saveCotizacion()"/>',document.getElementById("ContmodalAlerta").innerHTML=d,$("#btn_confirmCRT0").html(s),$("#btn_confirmCRT2").addClass("hidden"),!0):"control"==t?(console.log("pedirCotizacion2 - f"),document.getElementById("savicotizacion").disabled=!0,$("#ContmodalAlerta").html(o),console.log("ALERTA 2 DE READ==CONTROL"),$("#btn_confirmCRT2").addClass("hidden"),MostrarAlerta(3),!1):($("#muestra a").each(function(e){console.log("pedirCotizacion2 - g");this.href="#",$(this).off()}),$("#muestra input").each(function(e){console.log("pedirCotizacion2 - h");this.readOnly="1",$(this).off(),document.getElementById("btn_update0").disabled=!0}),$("#btn_confirmCRT0").html(s),$("#btn_confirmCRT").attr("disabled",!0),$("#savicotizacion").attr("disabled",!0),$("#idpedido3").val(a),$("#idpedido4").val(a),"control"!=t&&($("#btn_confirmCRT").val("Su pedido ha sido guardado exitosamente"),d+=" y guardado exitosamente.<br>"),$("#msg_confirmCRT0").html("Consulte en : Pedidos en proceso."),document.getElementById("btn_update0").disabled=!0,$("#idpedido").val(a),"control"!=t&&(d="Su pedido ha sido guardado. <br/> <h4 class='MsgAlertaPanel'>Su número de folio es: <span class='MsgAPanel'>"+a+"</span></h4><br/><div style='display:flex; flex-direction:row; justify-content:space-around;'><button style='width:140px;font-size:10px;' onClick='actualizastatuspedidocltecredito(1000,"+a+",1)'><i class='fa fa-paper-plane' aria-hidden='true'></i> Enviar Pedido</button><button class='btn btn-primary' style='width:140px;' onclick='verificapendientesdepago(2)'><i class='fa fa-check' aria-hidden='true'></i> Pagar y enviar...</button></div>"),$("#ControlImpresion").html('<input type="button" value=""  class="btn icobtn-successImprimir" onClick="javascript:document.getElementById(\'000003\').submit()"/>'),document.getElementById("creada").innerHTML="",document.getElementById("ContmodalAlerta").innerHTML=d,void MostrarAlerta(3))})):alert("No hay Productos.")}function ResC(e,a){var t="0123456789",o="-0123456789",i=" abcdefghijklmnñopqrstuvwxyzABCDEFGHIJKLMNÑOPQRSTUVWXYZ-",n=[8,37,46,39];switch(a){case"num":a=t;break;case"car":a=i;break;case"num_car":a="0123456789 abcdefghijklmnñopqrstuvwxyzABCDEFGHIJKLMNÑOPQRSTUVWXYZ-";break;case"date":case"hr":a=o;break;case"monto":a=".0123456789"}var d,e=e||window.event,s=e.charCode||e.keyCode,e=String.fromCharCode(s),r=!1;for(d in n)if(s==n[d]){r=!0;break}return-1!=a.indexOf(e)||r}function ValidePromoxArticulo(clave_articulo){$.post("spages/ofertasArticuloCliente",{clave_articulo:clave_articulo},function(data){var c=eval(data),i=0,j=1;for(x=0;x<c.length;x++)for(var IDVID=c[x].datos,v=Array(),vecto=Array(),t=0,v=IDVID.split(","),t=0;t<v.length-1;t++){var clave_articulo2=v[t],vecto=clave_articulo2.split("|");$("#PROT"+vecto[0]).html("<img alt='gifpeque' src='assets/img/gifpeque.gif' style=' width:25px; height:25px;border-bottom: 1px solid #f1f1f1;'><span style=\"color:#F00;\">"+vecto[1]+"%</span>")}})}function closeModalAlerta(){$(".quantity").blur(),$(".isInvoice").prop("checked",!1),$(".isInvoice").change(),$("#ContmodalAlerta").removeClass("hidden"),$("#body-process_invoice").addClass("hidden"),$("#modal-footer-invoice").removeClass("hidden"),$(".is_invoice").removeClass("hidden"),$("#btn_confirmCRT2").removeClass("hidden")}function validateForm(e){let a=!1;return $(e).find("select, textarea, input").each(function(){$(this).prop("required")&&($(this).val()||(a=!0,$(this).parent().addClass("has-error"),$(this).parent().next().find(".select2-selection .select2-container").addClass("has-error")))}),!a}const store_cities=function(t){return new Promise((e,a)=>{$.ajax({url:"spages/addCity",method:"post",dataType:"json",data:t}).done(e).fail(a)})},store_location=function(t){return new Promise((e,a)=>{$.ajax({url:"spages/addLocation",method:"post",dataType:"json",data:t}).done(e).fail(a)})},saveQuote=function(t,o=!1){return new Promise((e,a)=>{$.ajax({url:o?"spages/NuevaCotizar/":"spages/SaveCotizacion/",type:"post",method:"post",dataType:"json",data:t}).done(e).fail(a)})},storeAddress=function(t){return new Promise((e,a)=>{$.ajax({url:"spages/addCustomerAddress",method:"post",dataType:"json",data:t}).done(e).fail(a)})},loadAddressLost=function(t){return new Promise((e,a)=>{$.ajax({url:"spages/getLostAddress/",method:"post",dataType:"json",data:t}).done(e).fail(a)})},getLocationByDirClicId=function(t){return new Promise((e,a)=>{$.ajax({url:"spages/getLocationByDirClicId",method:"get",dataType:"json",data:{dir_cli_id:t}}).done(e).fail(a)})},storePickup=function(t){return new Promise((e,a)=>{$.ajax({url:"spages/ConfirmarPreciosPago",type:"post",dataType:"json",data:{opcion:t}}).done(e).fail(a)})},editOrder=function(t){return new Promise((e,a)=>{$.ajax({url:"spages/confirmar_pedido3",method:"get",dataType:"json",data:{idcotizacion:t,isPayOnline:!0}}).done(e).fail(a)})},editOrderWithValidExistence=function(t,o=0){return new Promise((e,a)=>{$.ajax({url:"spages/editOrder",type:"post",method:"post",dataType:"json",data:{idcotizacion:t,isPayOnline:o}}).done(e).fail(a)})},loading=function(e){return $("."+e).html('<img alt="loading" src="assets/img/loading.gif">')},shippingAvailability=function(t,o=0){return new Promise((e,a)=>{$.ajax({url:"spages/shippingAvailability",method:"get",dataType:"json",data:{location_id:t,isFront:o}}).done(e).fail(a)})},getShippingCost=function(t,o=!1){return new Promise((e,a)=>{$.ajax({url:"spages/getShippingCost",method:"get",dataType:"json",data:{dir_cli_id:t,recalculate:!0,isPayment:o}}).done(e).fail(a)})},validteMinimunOrder=function(){return new Promise((e,a)=>{$.ajax({url:"spages/validateMinimumOrder",method:"get",dataType:"json"}).done(e).fail(a)})},getState=function(){return new Promise((e,a)=>{$.ajax({url:"spages/getStates",method:"get",dataType:"json"}).done(e).fail(a)})},getCities=function(t){return new Promise((e,a)=>{$.ajax({url:"spages/getCitiesByStateId",method:"get",dataType:"json",data:{state_id:t}}).done(e).fail(a)})},getLocations=function(t){return new Promise((e,a)=>{$.ajax({url:"spages/getLocalitiesByCityId",method:"get",dataType:"json",data:{city_id:t}}).done(e).fail(a)})},clarifications=function(t,o,i){return new Promise((e,a)=>{$.ajax({url:`spages/aclarar/${t}/`+o,method:"post",dataType:"json",data:{comments:i}}).done(e).fail(a)})},validPostalCode=function(e){let t="https://api.copomex.com/query/info_cp/"+e;return new Promise((e,a)=>{$.ajax({url:t,method:"get",dataType:"json"}).done(e).error(a)})},getCleanedString=function(e){for(var a="!@#$^&%*()+=-[]/{}|:<>?,.",t=0;t<a.length;t++)e=e.replace(new RegExp("\\"+a[t],"gi"),"");return e=(e=(e=(e=(e=(e=(e=(e=e.toLowerCase()).replace(/ /g,"_")).replace(/á/gi,"a")).replace(/é/gi,"e")).replace(/í/gi,"i")).replace(/ó/gi,"o")).replace(/ú/gi,"u")).replace(/ñ/gi,"n")},formatCurency=function(e){return e.toFixed(2).replace(/(\d)(?=(\d{3})+(?!\d))/g,"$1,")};